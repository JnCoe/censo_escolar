---
title: "Análise vacinação"
author: "Jonas Coelho"
date: "01/07/2021"
output: 
  html_document:
    theme: cosmo
    toc: true
    toc_float:
      collapsed: false
    number_sections: true
    df_print: paged
    code_folding: show
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introdução

Esse documento pretende analisar a vacinação nos municípios brasileiros dos profissionais da educação. Serão utilizadas as bases do Ministério da Saúde sobre vacina contra covid, a base do FNDE sobre remuneração dos servidores da educação e a base do INEP do Censo Escolar. Para o INEP e MS, será utilizada a API da [Base dos dados](https://basedosdados.org/) no BigQuery, enquanto para os dados do FNDE serão utilizados os CSVs disponibilizados pela autarquia.

O primeiro passo consiste em carregar as bibliotecas necessárias.
```{r message=FALSE, warning=FALSE}
library("basedosdados")
library('dplyr')
library(knitr)
library(kableExtra)
options(scipen = 9999)
```

E definir o projeto do BigQuery
```{r message=FALSE, warning=FALSE}
# Definindo o projeto do BigQuery
set_billing_id("base-dos-dados-316520")
```

## Carregar dados de vacinação
Para evitar processamentos repetitivos, os códigos de execução no BigQuery serão explicitados aqui apenas para elucidação. As informações carregadas virão, de fato, do arquivo .RData com os dados salvos do resultado desse processamento.

Os dados de vacinação estão organizados em três tabelas diferentes: estabelecimento, paciente e vacinação. A tabela de estabelecimentos não nos é necessária nessa análise. Ela contém identificação sobre os postos de saúde e demais pontos de vacinação. A tabela de pacientes possui uma id aleatória para cada paciente, sua idade, data de nascimento, sexo, raça/cor, endereço (cep, município e UF) bem como nacionalidade. Por fim, a tabela de vacinação consiste em dados sobre o paciente que foi vacinado, qual a dose em questão, lote, fabricante, data de aplicação, o estabelecimento onde foi distribuída e o grupo de atendimento - ou seja - a razão pela pessoa ter tido acesso à vacina.

O grupo de atendimento é a classificação mais detalhada, enquanto a categoria é uma categorização mais abrangente entre 9 classes distintas. Os dados podem ser consultados na tabela de dicionário da base, disponibilizada abaixo:

```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT * FROM `basedosdados.br_ms_vacinacao_covid19.dicionario` LIMIT 1000"
dicionario <- read_sql(query)
```

```{r}
load('../dados/basedosdados/dicionario_vacinacao.rdata')
dicionario
```

Existem dois grupos de atendimento que nos interessam: o '801 - Ensino Básico' e . Antes de filtrá-lo, porém, vamos realizar umas análises na base para verificar como está a integridade dos dados no geral e identificar possíveis falhas.


### Integridade da tabela de vacinação

Um erro que já foi relatado por outros pesquisadores em relação à base do MS consiste na presença de múltiplas doses para apenas um paciente. Vamos ver quais são os casos em que há mais de duas doses registradas para um mesmo paciente. Assim como antes, o resultado da query virá de um RData já salvo, mas pode ser gerado com o código disponibilizado abaixo.

```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT id_paciente, COUNT(id_documento)
FROM `basedosdados.br_ms_vacinacao_covid19.microdados_vacinacao`
GROUP BY id_paciente
HAVING COUNT(id_documento)>2;"

super_doses <- read_sql(query)
```

```{r}
load('../dados/basedosdados/super_doses.rdata')
```

```{r}
super_doses %>%
  arrange(desc(f0_))
```
Há 1,4 milhões de pacientes com mais de 2 doses registradas. Em um caso, 462 doses foram registradas como se inoculadas em uma mesma pessoa. Uma observação relevante que deve ser feita, no entanto, é que o caso dos 462 registros ocorreram no Rio Grande do Norte, mas em prefeitura diferentes. Seria interessante, em outra oportunidade, investigar a causa para isso.

Apesar da id de pacientes não ter sido inserida corretamente, é possível observar, ao se explorar a base, que outras colunas foram preenchidas com dados diferentes, tais como data de aplicação, dose, fabricante e, o mais importante, categoria e grupo de atendimento. Por esse motivo, vamos fazer a análise sem desconsiderar essas duplicatas. Os dados, portanto, podem estar sobreinclusivos, visto que não é possível garantir que as doses registradas incorretamente de fato foram administradas da forma como estão registradas.

## Obter dados de vacinação por município

Para obter os dados consolidados por município, é necessário fazer uma escolha: o município referência consiste no local onde foi aplicada a dose ou de residência do paciente? No primeiro caso, utilizaremos a tabela de estabelecimentos, enquanto no segundo usaremos a de pacientes. Entretanto, como o registro dos dados possui falhas como as apontadas anterioremente, a utilização dos dados dos pacientes poderia gerar distorções.

Por esse motivo, vamos considerar quantas doses cada município administrou em seus postos de vacinação para comparar, posteriormente, com os funcionários da educação que atuam no mesmo município. Essa análise não é 100% precisa, porém fornece valores aproximados o suficiente para nosso objetivo.

Outro nuance que deve ser observado consiste em casos onde um indivíduo tomou a primeira dose em um município e a segunda em outro. Como não vamos utilizar a id do paciente, serão analisados apenas os quantitativos de cada dose por município, calculando o deficit faltante com base na diferença. Ainda assim, por ser pouco provável que haja um número considerável de casos nesse estilo, a análise será feita com a premissa de que todos que tomaram a segunda dose em um determinado município também tomaram a primeira no mesmo município. Vamos aproveitar e gerar uma tabela com os dados totais e com os dados filtrados, assim poderemos checar se os valores estão condizentes com outras fontes.

```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT
  est.id_municipio,
  COUNT(DISTINCT
    CASE
      WHEN dose = 1 THEN id_documento
  END
    ) AS prim_dose,
  COUNT(DISTINCT
    CASE
      WHEN dose = 2 THEN id_documento
  END
    ) AS segun_dose,
  COUNT(DISTINCT
    CASE
      WHEN dose IS NULL THEN id_documento
  END
    ) AS dose_nula,
  COUNT(DISTINCT id_paciente) AS num_pacientes
FROM
  `basedosdados.br_ms_vacinacao_covid19.microdados_vacinacao` AS vac
LEFT JOIN
  `basedosdados.br_ms_vacinacao_covid19.microdados_estabelecimento` AS est
ON
  vac.id_estabelecimento = est.id_estabelecimento
WHERE
  grupo_atendimento = '801'
GROUP BY
  est.id_municipio;"

compilado_mun <- read_sql(query)

query <- "SELECT
  est.id_municipio,
  COUNT(DISTINCT
    CASE
      WHEN dose = 1 THEN id_documento
  END
    ) AS prim_dose,
  COUNT(DISTINCT
    CASE
      WHEN dose = 2 THEN id_documento
  END
    ) AS segun_dose,
  COUNT(DISTINCT
    CASE
      WHEN dose IS NULL THEN id_documento
  END
    ) AS dose_nula,
  COUNT(DISTINCT id_paciente) AS num_pacientes
FROM
  `basedosdados.br_ms_vacinacao_covid19.microdados_vacinacao` AS vac
LEFT JOIN
  `basedosdados.br_ms_vacinacao_covid19.microdados_estabelecimento` AS est
ON
  vac.id_estabelecimento = est.id_estabelecimento
WHERE
  grupo_atendimento = '801'
GROUP BY
  est.id_municipio;"

compilado_mun_total <- read_sql(query)
```

```{r}
load('../dados/basedosdados/compilado_mun.rdata')
```

Vamos agora juntar as tabelas com os dados do IBGE para população, além de obter informações sobre o municipio.

```{r eval=FALSE}
# Código R para importar dados do SIDRA (não executado)
pop <- sidrar::get_sidra(6579,
                         period = '2020',
                         variable = 9324,
                         geo = "City") %>%
  janitor::clean_names() %>%
  select(municipio_codigo, municipio, valor) %>%
  rename(pop = valor)
```

```{r}
load('../dados/basedosdados/pop.rdata')
```

```{r}
compilado_mun_total_old <- compilado_mun_total
compilado_mun_old <- compilado_mun

compilado_mun_total <- pop %>%
  left_join(compilado_mun_total_old, by = c('municipio_codigo' = 'id_municipio'))

compilado_mun <- pop %>%
  left_join(compilado_mun_old, by = c('municipio_codigo' = 'id_municipio'))
```

```{r}
compilado_mun_total %>%
  arrange(desc(segun_dose))
```

Comparando com os dados do [Vacinômetro Paulista](https://vacinaja.sp.gov.br/vacinometro/), é possível notar que os dados parecem estar corretos. Há uma divergência considerando que o BigQuery é atualizado semanalmente e possui uma diferença de 4 dias entre ambos, mas os valores estão aproximados o suficiente para parecerem corretos. Vamos prosseguir para os dados dos profissionais de educação.

Uma observação relevante é que há casos em que a dose não foi preenchida. Não se trata das vacinas de dose única porque São Paulo já administrou quase 100 mil doses desse tipo segundo o Vacinômetro Paulista, enquanto o município com o maior número de doses sem preenchimento (Caruaru - PE) possui 396. Por serem valores muito baixos perto do total, iremos desconsiderar essa coluna.

## Carregar dados de profissionais da educação
Para saber o quantitativo de profissionais da educação por município, temos dois caminhos diferentes: o censo escolar e os dados do SIOPE. O Censo Escolar tem a vantagem de ser de rápido processamento e conter dados de professores tanto da rede pública quanto privada, no entanto, não possui informações sobre outros profissionais da educação (merendeiras, inspetores, coordenadores etc).

Os dados do SIOPE possuem informações para todos esses profissionais, mas somente na rede pública. Além disso, o processamento de dados do SIOPE é consideravelmente mais demorado, porque envolve baixar CSVS individuais para cada estado, compilar e subir no BigQuery. Por conta dessa limitação, vamos optar por utilizar os dados do censo na análise. Como consequência, os números apresentados de funcionários da educação em cada município estarão aquém do valor real. Posteriormente, uma análise do SIOPE pode ajudar a aperfeiçoar esses números.

O código abaixo gera uma tabela com a soma de IDs distintas de docentes por município, categorizando em três colunas: rede privada, rede pública e o total de ambas. Os dados não foram filtrados por etapa, então inclui docentes de ensino técnico, EJA e outras modalidades que não estão inseridas no ensino superior.

```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT
  id_municipio,
  COUNT(DISTINCT
    CASE
      WHEN rede = 'privada' THEN id_docente
  END
    ) AS total_privada,
  COUNT(DISTINCT
    CASE
      WHEN rede != 'privada' THEN id_docente
  END
    ) AS total_publica,
  COUNT(DISTINCT id_docente) AS total_municipio,
FROM
  `basedosdados.br_inep_censo_escolar.docente`
WHERE
 ano = 2020
GROUP BY
  id_municipio
ORDER BY
  total_municipio DESC;"

num_docentes <- read_sql(query)
```

```{r}
load('../dados/basedosdados/num_docentes.rdata')
```

Vamos dar uma olhada nos dados:

```{r}
num_docentes
```

É possível notar que a soma das colunas privada + pública não corresponde ao total. Isso é consequência de professores que atuam na mesma rede. Como é possível filtrar por IDs de identificação únicas, obtemos o valor real total de docentes em cada município. Importante observar, no entanto, que professores que lecionam em mais de um município serão contabilizados em ambos, visto que os dados estão agrupados por cidade.

Se desconsiderarmos inclusive o agrupamento por município, podemos obter o número de 2.539.853 docentes em todo o país ao executar o código abaixo:

```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT
  COUNT(DISTINCT id_docente)
FROM
  `basedosdados.br_inep_censo_escolar.docente`
WHERE
  ano = 2020;"

total_docentes_brasil <- read_sql(query)
```

## Unificação das tabelas

```{r}
tabela_final <- compilado_mun %>%
  left_join(num_docentes, by = c('municipio_codigo' = 'id_municipio'))
```

# Análise

Primeiramente, vamos ver quantos docentes já estão com a primeira e segunda dose em comparação ao total no Brasil.

```{r}
tabela_final %>%
  summarise(total_pr = sum(prim_dose, na.rm=TRUE), prop_prim = total_pr/	
2539853, total_seg = sum(segun_dose, na.rm=TRUE), prop_seg = total_seg/	
2539853)
```

Já de imediato temos um problema: o valor de funcionários da educação básica que receberam a primeira dose é maior que o valor de funcionários da educação básica que existem no Brasil. Ou seja, o número de funcionários além dos professores importa bastante.

Uma forma de contornar esse problema pode estar no próprio Censo Escolar: na tabela de escolas, há uma coluna com a quantidade de funcionários. É possível imaginar um modelo preditivo que calcule o número de funcionários numa escola com base no número de docentes e aplicar esse modelo para todo o município. Ocorre que esse dado é preenchido pelos diretores, de forma completa arbitrária, e não é verificado posteriormente de nenhuma forma.

Outra possível solução seria analisar os dados do RAIS, que pode contar essa informação.

# RAIS

# Elaborando a melhor estratégia

Na tabela da RAIS, cada linha representa um vínculo empregatício, ativo ou não. Os dados não possuem identificador único, apenas informações gerais como tipo de vínculo (CBO), atividade econômica do empregador (CNAE), gênero, raça e idade do empregado entre outros.

Antes de mais nada, nós precisamos fragmentar a base para não sobrecarregar as queries do BigQuery desnecessariamente. Para isso, vamos criar uma tabela ativa clonando apenas os dados de 2019 e filtrando os CBOs que possam estar minimamente relacionados à educação, incluindo por exemplo Limpeza de prédios ou outros serviços de auxílio.

O código usado para isso foi o seguinte:

```{sql eval=FALSE}
--Código para gerar a tabela ativa (não executado neste doc)
SELECT * FROM `basedosdados.br_me_rais.microdados_vinculos` WHERE ano = 2019 AND cbo_2002 IN ('333110', '233115', '233120', '233125', '233130', '233135', '233205', '233210', '233215', '233220', '233225', '234105', '234110', '234115', '234120', '234125', '234205', '234210', '234215', '234305', '234310', '234315', '234320', '234405', '234410', '234415', '234420', '234425', '234435', '234445', '234450', '234455', '234460', '234505', '234510', '234515', '234520', '234705', '234710', '234715', '234720', '234725', '234730', '234735', '234740', '234745', '234750', '234755', '234760', '234765', '234770', '234805', '234810', '234815', '234905', '234910', '234915', '239420', '239435', '252320', '262830', '333105', '334115', '371105', '371110', '515305', '515325', '231105', '231110', '231205', '231210', '231305', '231310', '231315', '231320', '231325', '231330', '231335', '231340', '232105', '232110', '232115', '232120', '232125', '232130', '232135', '232140', '232145', '232150', '232155', '232160', '232165', '232170', '233105', '234604', '234612', '234616', '234620', '234624', '234628', '234632', '234640', '234644', '234652', '234660', '234664', '234668', '234672', '234676', '234684', '239405', '239410', '239415', '239425', '239430', '331305', '332105', '334105', '334110', '234608', '331105', '331110', '331205', '239205', '239210', '239215', '239220', '239225', '332205', '233110', '251505', '333115')
```

Agora vamos importar essa tabela, filtrando para manter apenas aqueles funcionários com vínculo ativo em 31/12/2019. Para reduzir a carga no R, vamos agregar os resultados por municipio, cbo e informações sobre o trabalhador



Agora vamos importar as informações relevantes para o R, para analisarmos os resultados obtidos. Iremos agregar o total de vínculos por CBO e CNAE, mantendo apenas aqueles ativos em 31/12/2019.
```{r eval=FALSE}
# Código R para importar dados do BigQuery (não executado)
query <- "SELECT cnae_2_subclasse, cbo_2002, COUNT(*) as total FROM `base-dos-dados-316520.rais2018.selecao2019` WHERE vinculo_ativo_3112 = '1' GROUP BY cnae_2_subclasse, cbo_2002;"
cnaes_cbo <- read_sql(query)
```

```{r}
# Código para carregar o arquivo RData com as informações já salvas
load('../dados/basedosdados/cnaes_cbo.rdata')
```

Vamos precisar um dicionário de CNAEs e CBOs também visto que só temos o número.

```{r}
# Dicionário de CNAEs
dici_cnae <- data.table::fread('../dados/dici_cnae.csv', encoding = 'UTF-8', colClasses = 'character') %>%
  mutate(id_classe = gsub('\\.|-',"", cod_classe)) %>%
  rename(cnae_2_subclasse = id_cnae)
```

```{r}
# Dicionário de CBOs
dici_cbo <- data.table::fread('../dados/CBO_map.csv', encoding = 'UTF-8', colClasses = 'character') %>%
  janitor::clean_names()
 
colnames(dici_cbo)[1:2] <- c('ocupacao', 'cbo_2002')
```

Juntando a tabela com os dicionários:

```{r}
cnaes_cbo2 <- cnaes_cbo %>%
  left_join(select(dici_cnae, cnae_2_subclasse, nm_cnae)) %>%
  left_join(dici_cbo)
```

Para entendermos qual a melhor estratégia que podemos adotar, auxilia observar como estão distribuídos os CNAEs e CBOs. Um gráfico interativo pode ser encontrado em [Gráfico Cbo CNAE](Grafico-CBO-CNAE.html).

Os resultados também podem ser diretamente explorados (de forma menos intuitiva) na tabela abaixo:

```{r}
cnaes_cbo2 %>%
  arrange(desc(total)) %>%
  select(nm_cnae, ocupacao, total) %>%
  DT::datatable(filter = 'top', options = list(scrollX='600px'))
```

É possível notar que há uma série de CBOs relevantes para nossa análise associados a CNAEs atípicos. Por exemplo, temos o CBO "Inspetor de Alunos de Escola Publica" com 127 vínculos a instituições com o CNAE "Atividades de organizações associativas ligadas à cultura e à arte". Entre outros exemplos similares podemos citar:
- "Professor de Historia no Ensino Medio" em CNAEs "Atividades de organizações religiosas ou filosóficas"
- "Professor de Educacao Fisica do Ensino Fundamental" em CNAEs "Ensino de esportes"
- "Inspetor de Alunos de Escola Publica" em CNAEs "Fornecimento e gestão de recursos humanos para terceiros"

Quais as possíveis explicações para isso? Primeiramente, é possível imaginar instituições de ensino vinculadas à pessoas jurídicas com CNAEs diferentes (por exemplo, escolas religiosas ou então de associações). Há também os casos evidentes de terceirização. Mas como seria inevitável, parecem existir casos em que há apenas inserção incorreta dos dados. Por exemplo, no CNAE "Lanchonetes casas de chá de sucos e similares" há uma série de CBOS como "Coordenador Pedagogico" ou "Inspetor de Alunos de Escola Publica". Pode ser que haja uma explicação para isso, mas como é possível encontrar diversos CBOs parecidos em CNAEs sem nenhuma relação aparente, deve se ter em mente as limitações dos dados.

De qualquer forma, para a educação básica, parece seguro incluir todas as instituições que possuem CNAE "Ensino fundamental" ou "Ensino médio", por exemplo.

As complicações giram em torno dos inúmeros casos em que o CNAE é "Administração pública em geral" ou alguma das associações citadas anteriormente, que podem ou não se referir a escolas. Embora alguns CBOs (como por exemplo Professor de Matematica no Ensino Medio) claramente sejam do ensino básico, há diversos vínculos com o ensino superior, por exemplo, demonstrando a fragilidade do CBO.

Há também casos ainda mais cinzentos como "Professor de dança", que pode estar atuando tanto em escolas como fora delas. Por esse motivo, vamos adotar uma estratégia de relativização. Todos os CNAEs tipicamente escolares terão seus vínculos considerados. Já os que podem ou não estar relacionados à atividade escolar só terão seus vínculos considerados se associados a CBOs que façam sentido.

Essa estratégia tem como vantagem a inclusão de vínculos de auxiliares que operam em escolas privadas com CNAE "Ensino Fundamental", por exemplo, mas como desvantagem a exclusão de outros funcionários que operem em escolas públicas ou escolas com CNAE diferente.

Os selecionados são:

CNAEs absolutos:
- Ensino fundamental (8513900)
- Educação infantil - pré-escola (8512100)
- Ensino médio (8520100)
- Educação infantil - creche (8511200)
- Atividades de apoio à educação exceto caixas escolares (8550302)
- Transporte escolar (4924800)
- Administração de caixas escolares (8550301)

CNAEs relativos:
- Administração pública em geral (8411600)
- Atividades de associações de direitos sociais (9430800)
- Serviços de assistência social sem alojamento (8800600)
- Outras atividades de ensino não especificadas anteriormente (	
8599699)
- Atividades de organizações religiosas ou filosóficas (9491000)
- Regulação das atividades de saúde educação serviços culturais e outros serviços sociais (8412400)

CBOs relativos:
- Auxiliar de Biblioteca (371105)
- Designer Educacional (239435)
- Educador Social (515305)
- Orientador Educacional (239410)
- Professor da Area de Meio Ambiente (233105)
- Professor de Danca (262830)
- Professor de Lingua Alema (234604)
- Professor de Lingua Espanhola (234620)
- Professor de Lingua Francesa (234612)
- Professor de Lingua Inglesa (234616)
- Professor de Lingua Italiana (234608)
- Professor de Linguas Estrangeiras Modernas (234668)
- Professor de Literatura Comparada (234640)
- Professor de Literatura de Linguas Estrangeiras Modernas (234660)
- Professor de Outras Linguas e Literaturas (234664)
- Socioeducador (515325)
- Supervisor de Ensino (239430)
- Coordenador Pedagogico (239405)
- Inspetor de Alunos de Escola Publica (334110)
- Professor da  Educacao de Jovens e Adultos do Ensino Fundamental (Primeira a Quarta Serie) (231205)
- Professor de Alunos com Deficiencia Fisica (239210)
- Professor de Alunos com Deficiencia Multipla (239220)
- Professor de Ciencias Exatas e Naturais do Ensino Fundamental (231305)
- Professor de Educacao Fisica do Ensino Fundamental (231315)
- Professor de Geografia do Ensino Fundamental (231320)
- Professor de Geografia no Ensino Medio (232135)
- Professor de Historia do Ensino Fundamental (231325)
- Professor de Historia no Ensino Medio (232140)
- Professor de Lingua Estrangeira Moderna no Ensino Medio (232150)
- Professor de Lingua Portuguesa (234624)
- Professor de Literatura Brasileira (234628)
- Professor de Literatura Inglesa (234652)
- Professor de Matematica no Ensino Medio (232155)
- Professor de Nivel Medio no Ensino Fundamental (331205)
- Professor de Nivel Superior do Ensino Fundamental (Primeira a Quarta Serie) (231210)
- Professor de Nivel Superior na Educacao Infantil (Zero a Tres Anos) (231110)
- Professor de Psicologia no Ensino Medio (232160)
- Professor de Quimica no Ensino Medio (232165)
- Psicologo Educacional (251505)
- Auxiliar de Desenvolvimento Infantil (331110)
- Inspetor de Alunos de Escola Privada (334105)
- Monitor de Transporte Escolar (334115)
- Pedagogo (239415)
- Professor de Alunos com Deficiencia Auditiva e Surdos (239205)
- Professor de Alunos com Deficiencia Mental (239215)
- Professor de Alunos com Deficiencia Visual (239225)
- Professor de Artes no Ensino Medio (232105)
- Professor de Biologia no Ensino Medio (232110)
- Professor de Disciplinas Pedagogicas no Ensino Medio (232115)
- Professor de Educacao Artistica do Ensino Fundamental (231310)
- Professor de Educacao Fisica no Ensino Medio (232120)
- Professor de Filologia e Critica Textual (234676)
- Professor de Filosofia no Ensino Medio (232125)
- Professor de Fisica no Ensino Medio (232130)
- Professor de Lingua e Literatura Brasileira no Ensino Medio (232145)
- Professor de Lingua Estrangeira Moderna do Ensino Fundamental (231330)
- Professor de Lingua Portuguesa do Ensino Fundamental (231335)
- Professor de Linguistica e Linguistica Aplicada (234672)
- Professor de Literatura Espanhola (234644)
- Professor de Literatura Portuguesa (234632)
- Professor de Matematica do Ensino Fundamental (231340)
- Professor de Nivel Medio na Educacao Infantil (331105)
- Professor de Nivel Medio no Ensino Profissionalizante (331305)
- Professor de Nivel Superior na Educacao Infantil (Quatro a Seis Anos) (231105)
- Professor de Sociologia no Ensino Medio (232170)
- Professor Leigo no Ensino Fundamental (332105)
- Psicopedagogo (239425)
- Tecnólogo em Secretariado Escolar (252320)

Vamos gerar a tabela ativa e importar os dados para o R.

```{sql eval=FALSE}
--Código para gerar a tabela ativa (não executado neste doc)
SELECT * FROM `basedosdados.br_me_rais.microdados_vinculos` WHERE ano = 2019 AND vinculo_ativo_3112 = '1' AND (cnae_2_subclasse IN ('8513900', '8512100', '8520100', '8511200', '8550302', '4924800', '8550301') OR (cnae_2_subclasse IN ('8411600', '9430800', '8800600', '8599699', '9491000', '8412400') AND cbo_2002 IN ('371105', '239435', '515305', '239410', '233105', '262830', '234604', '234620', '234612', '234616', '234608', '234668', '234640', '234660', '234664', '515325', '239430', '239405', '334110', '231205', '239210', '239220', '231305', '231315', '231320', '232135', '231325', '232140', '232150', '234624', '234628', '234652', '232155', '331205', '231210', '231110', '232160', '232165', '251505', '331110', '334105', '334115', '239415', '239205', '239215', '239225', '232105', '232110', '232115', '231310', '232120', '234676', '232125', '232130', '232145', '231330', '231335', '234672', '234644', '234632', '231340', '331105', '331305', '231105', '232170', '332105', '239425', '252320')))
```

Isso gera uma tabela com 3411085. Podemos, então, começar a análise propriamente dita.


